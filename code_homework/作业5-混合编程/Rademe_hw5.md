# Rademe_hw5

# 混合编程发开文档

项目源码地址：https://github.com/yyh2154064/Masm_8086.git

## 1.嵌入式混合编程

### 1.1.简介

嵌入式混合编程，表明在写c语言的代码中，可以直接嵌入汇编代码，嵌入格式如下：

```c
__asm{ 
    汇编语句 
    汇编语句 
    …… 
} 
```

总体上讲，只是采用了汇编的逻辑来实现部分功能，实际操作中并没有很实用

### 1.2.遇到的问题

1.嵌入的汇编代码，并不能使用byte, word等语句定义的数据，而且操作码必须要使用有效的8086指令。除此之外，嵌入的汇编代码中诸如mov等指令的操作数，可以包括：寄存器、变量（局部、全局）与参数、结构体成员

### 1.3.完成的代码与心得体会

嵌入式代码的编程并不复杂，两种语言的接口也仅仅是一个__asm{}，因此我写了一个比较简单的代码：键盘输入a, b, c的值，汇编求和，并将结果返回给定义好的变量，最终由c语言进行打印输出。

这里有关键盘的输入，我是直接用c语言完成的，如果要用汇编来写也比较容易，前面的项目（输入年月日输出）有涉及，这里为了速度就直接使用scanf函数了，总体而言，嵌入式混合编程只需要注意`__asm{}`接口的使用即可, **`__asm{}`向上兼容`_asm{}`。**



## 2.模块化混合编程

### 2.1.简介

相比于嵌入式编程，模块化编程更为实用，功能也更强。在模块化编程的过程中，和前一次项目一样，对于需要被外部调用的过程或全局变量，采用public伪指令进行声明；而对于本模块中使用其他模块中定义的全局变量或函数，则应该采用extrn伪指令说明。

子程序里bx, cx, es寄存器是可以自由使用的，其他寄存器则在使用前需要进行数据保护。 

### 2.2.遇到的问题

1.我在c中需要调用汇编变量的时候，汇编相应的地方需要加下划线，但是c模块并不需要这样，c在编译的时候会自动在变量名前加下划线，所以为保持一致，c在编译的时候并不需要添加下划线

 除此之外，由于我的变量存在c的程序中，所以不需要额外添加下划线。

2.关于end，由于c语言的程序中已经有main函数，因此end不需要指出指令的起点，如果指出会报错。这里我的程序中没有使用到

3.有关函数调用规约

c语言中，调用者的所有参数从右向左入栈。因此，在参数传递里，可以看到我的汇编代码是这样写的：

```
    ; 输出结果: eax - 返回值
    mov ax, [esp + 4]  ; a
    add ax, [esp + 8]  ; b
    add ax, [esp + 12] ; c
```

### 2.3.完成的代码与心得体会

总体而言，这次项目是让我体会嵌入式的混合编程中变量的直接使用，模块化混合编程中变量、过程都需要先声明，再使用（声明时汇编代码变量需要加下划线）。知识点并不难，而我也仅仅是选择了键盘输入并求和这样一个简单的题目。但在实现的过程中也涉及到了参数传递的理解、公有变量的声明使用等问题。总体上讲知识点不多，但理解起来还是需要花费一些时间。